Azure 管理者向けの前提条件
Azure PowerShell
Azure PowerShell: Windows PowerShell またはPowerShell Coreに追加するモジュールで、自分のAzureサブスクリプションに接続してリソースを管理できるようにする。
PowerShellが機能している必要あり
シェルウィンドウやコマンド解析などのサービスを提供
利用方法
Azure Cloud Shell: ブラウザー内で利用
ローカル: Linux, macOS, WindowsOSにローカルインストールして利用
Azモジュール: Azure機能で使用できるコマンドレットを含むAzure PowerShellコマンドレットの正式名称。あらゆるAzureリソースのほぼ全ての面を制御
リソースグループ
記憶域
VM
Azure AD
Containers
機械学習
Azure CLI: Azure に接続しAzureリソースで管理コマンドを実行するためのコマンドラインプログラム。
Linux, macOS, Windows上で実行され管理者と開発者はWebブラウザーの代わりにターミナル、コマンドラインプロンプト、またはスクリプトを介してコマンドを実行できる。
ローカルでの実行が可能: Linux, macOS, WindowsOSを実行しているコンピューターにインストール
ブラウザからの使用が可能:Azure Cloud Shell を介してブラウザーから使用可能
対話形式:
Windows: cmd.exeなどのシェルを起動
Linux, macOS: Bash
スクリプト:選択したシェルノスクリプト構文を使用して複数のAzure CLIコマンドを1つのシェルスクリプトにまとめる。その後実行
ほぼあらゆるリソースを制御可能
リソースグループ
ストレージ
VM
Azure Active Directory
コンテナー
機械学習
Azure Resource Maneger
利点:
ソリューション内の複数のリソースを1つのグループとして作業できる。
全てのリソースを一回の連携した操作でデプロイ、更新、または削除可能
デプロイ時のテンプレートの使用: テスト、ステージング、運用環境などのさまざまな環境に使用できる。
デプロイ後のリソース管理に役立つ、セキュリティ、監査、タグ付けの機能が用意
一貫性のある管理レイヤー: Azure PowerShell, Azure CLI, Azure portal, REST API, クライアントSDKを通じてタスクを実行する一貫性のある管理レイヤーが提供される。
全ツールがAPIを介してAzure Resource Manager とやりとり
APIにより要求の認証と承認を行うAzure Resource Managerサービスに要求が渡される
Azure Resource Managerにより適切なリソースプロバイダーに要求がルーティングされる

メリット:
ソリューションのリソースを個別に処理するのではなく、全てのリソースをグループとしてデプロイ、管理、監視可能
ソリューションを開発のライフサイクル全体で繰り返しデプロイ可能。常にリソースが一貫した状態でデプロイ
スクリプトではなく宣言型のテンプレートを使用してインフラストラクチャを管理
ロールベースのアクセス制御が管理プラットフォームにネイティブに統合されるためリソースグループのすべてのサービスにアクセス制御を適用できる
タグをリソースに適用し、サブスクリプションの全てのリソースを論理的に整理
同じタグを共有するリソースグループのコストを表示することで組織の課金をわかりやすくすることができる
ガイダンス
命令型のコマンドを使用するのではなく、Azure Resource Managerテンプレート内の宣言型構文を使用してインフラストラクチャを定義及びデプロイする
命令型: 具体的に何をしているのかを定義(python でよく使う書き方)
宣言型: ゴールを抽象的な状態でそのまま記述(HTML, SQL)
デプロイと構成の手順全てをこのテンプレートで定義。ソリューションの設定に手動操作は必要ない
アプリやコンピューターの開始または停止などリソースの管理には命令型コマンドを実行
リソースグループないの同じライフサイクルでリソースを調整。リソースのその他の全ての整理にはタグを使用
用語
リソース: Azureを通じて管理できる要素。一般的なリソースとしては、仮想マシン、ストレージアカウント、Webアプリ、データベース、仮想ネットワークなどがある
リソースグループ: Azure ソリューションの関連するリソースを保持するコンテナー。リソースグループにはソリューションの全てのリソースか、グループとして管理したいリソースのみを含めることが可能。組織のニーズに合わせてリソースをリソースグループに割り当てる方法を指定
リソースプロバイダー: Resource Managerを使用してデプロイ及び管理できるリソースを提供するサービス。各リソースプロバイダーはデプロイされたリソースを利用するための操作を提供。
Microsoft.Compute: 仮想マシンリソースを提供
Microsoft.Storage: ストレージアカウントリソースを提供
Microsoft.Web: Webアプリに関連したリソースを提供
テンプレート: リソースグループにデプロイする1つ以上のリソースを定義するJSONファイル。デプロイ対象リソース間の依存関係もこのテンプレートによって定義。このテンプレートを使えばリソースを一貫性のある形で繰り返しデプロイ可能
宣言型構文: 一連のプログラミングコマンドを記述しなくても作成しようしているものを明確に宣言することのできる構文。
リソースグループを作成
リソースをリソースグループへデプロイすることでテンプレートの実行を追跡できるジョブになる
デプロイ失敗時、ジョブ出力によりデプロイが失敗した理由が示される
グループないの全てのリソースで同じライフサイクルが共有される必要がある　
あるリソースグループから別のリソースグループへリソースを移動可能
管理操作のアクセス制御のスコープを設定
他のリソースグループ内のリソースとやりとり可能
注意事項
リソースは1つのリソースグループのみ存在
リソースグループの名前は変更不可
リソースグループにはさまざまな種類のリソースを含めることができる
リソースグループには多くの異なるリージョンからのリソースを含めることができる
Azure リソースを再構成する
リソースの移動
新しいサブスクリプション
同じサブスクリプション内の新しいリソースグループ
リソースを移動する場合はその操作の間、ソースグループとターゲットグループの両方がロックされる。
移動が完了するまでブロック
追加、更新、削除が不可
使用可能
リソースとリソースグループの削除
そこに含まれているすべてのリソースが削除される
そのリソースグループには他のリソースグループで使用されているリソースが含まれている可能性がある
PowerShellを使用してリソースグループを削除
Remove-AzResourceGroup -Name “RGGROUPNAME”
リソース制限を決定する
現在の使用状況を追跡し、将来の使用を計画するのに役立つ
Azure Resource Manager テンプレートの利点についての確認
Azure Resource Managerテンプレートではデプロイに含まれるすべてのResource Managerリソースが正確に定義されている
リソースグループにResource Managerテンプレートをデプロイできる
テンプレート利点
テンプレートによって一貫性が向上
テンプレートは複雑なデプロイを表現するのに役立つ
テンプレートによりエラーが発生しやすい手動タスクが減る
テンプレートはコード
テンプレートにより再利用が推進される
テンプレートはリンク可能
テンプレートをまとめてリンクしてテンプレート自体をモジュール化することができる
テンプレートはオーケストレーションを簡略化する
Azure Resource Managerテンプレートスキーマ
JSONでの記述
格納データをオブジェクトとしてテキストで表す
$schema: テンプレート言語のバージョンが記述されているJSONスキーマファイルの場所
contentVersion: テンプレートのバージョン。任意の値を指定可能
parameters: リソースのデプロイをカスタマイズするのにはデプロイを実行すると提供されている値
variables: テンプレート言語式を簡略化するためにテンプレート内でJSONフラグメントとして使用される値
functions: テンプレート内で使用できるユーザー定義の関数
resources: リソースグループ内でデプロイまたは更新されるリソースの種類
outputs: デプロイ後に返される値
Azure Resource Manager テンプレートのパラメータについて
"parameters": {
    "<parameter-name>" : {
        "type" : "<type-of-parameter-value>",
        "defaultValue": "<default-value-of-parameter>",
        "allowedValues": [ "<array-of-allowed-values>" ],
        "minValue": <minimum-value-for-int>,
        "maxValue": <maximum-value-for-int>,
        "minLength": <minimum-length-for-string-or-array>,
        "maxLength": <maximum-length-for-string-or-array-parameters>,
        "metadata": {
        "description": "<description-of-the parameter>"
        }
    }
}
"parameters": {
  "adminUsername": {
    "type": "string",
    "metadata": {
      "description": "Username for the Virtual Machine."
    }
  },
  "adminPassword": {
    "type": "securestring",
    "metadata": {
      "description": "Password for the Virtual Machine."
    }
  }
}

Azure Resource Manager
Bicepテンプレート
Azure Bicep: 宣言型の構文を使用してAzure リソースをデプロイするドメイン固有言語(DSL)
簡潔な構文
信頼性の高いタイプセーフ
コードの再利用のサポートが提供
ARM テンプレートを作成するためのJSON構文は冗長になることがあり、複雑な指揮を必要とする。一方Bicep構文ではその複雑さが軽減され開発エクスペリエンスが向上する。
仕組み
リソースまたは一連のリソースをAzureにデプロイ
トランスパイル:BicepテンプレートがJSONテンプレートに変換
利点
シンプルな構文
モジュール性: 複雑なテンプレートデプロイを小さなモジュールファイルに分割しメインテンプレート内で参照できる
依存関係の自動管理: リソース間の依存関係は、Bicepによって自動検出される
種類の検証とIntelliSense: VS Code用のBicep拡張機能はAzureリソースの種類のAPI定義全てを対象とした豊富な検証機能とIntelliSenseを備える
クイックスタートテンプレート
Azure クイックスタートテンプレート: Azureコミュニティによって提供されているAzure Resource Managerのテンプレート
README.md: テンプレートの機能の概要
azuredeploy.json: デプロイされるリソースを定義
azuredeploy.parameters.json: テンプレートに必要な値を提供
対話型ラボシミュレーションーテンプレート
Azure PowerShell がタスクに合っているかどうかを判断する
管理ツール: 管理できる機能はほぼ同じ。Windows, macOS, 及びLinux上で動作する
Azure Portal: Azure サブスクリプションのリソースを作成、構成、変更することができるwebサイト。
Azure CLI: Azureに接続してAzureリソース上で管理コマンドを実行することができるクロスプラットフォームのコマンドラインプログラム。反復的なタスクを自動化するには、選択したシェルノスクリプト構文を使用して、複数のコマンドを1つのシェルスクリプトにまとめてスクリプトを実行
Azure Cloud Shell経由のブラウザー内
Linux, Mac, Windows上のローカルインストール
Azure PowerShell: PowerShellに追加し、Azureサブスクリプションに接続してリソースを管理することができるモジュール
PowerShellが機能している必要あり
PowerShellはシェルウインドウ、コマンド解析などのサービスを提供
Azure Az PowerShellモジュールでAzure固有のコマンドが追加
Azure Cloud Shell経由のブラウザー内
Linux, Mac, Windows上のローカルインストール
対話モード
スクリプトモード
PowerShellのインストール
Base PowerShell製品
Azure Az PowerShell モジュール: Azureリソースのほぼ全ての面を制御するためのコマンドレットを含む
PowerShell コマンドレット: PowerShellコマンド。
PowerShell モジュール: 利用可能な各コマンドレットを処理するコードを含むダイナミクリンクライブラリ
コマンドレットはモジュールに付属する


管理ツールを選択
自動化
学習曲線
チームのスキルセット: PowerShellの知識
ARM テンプレート
Infrastructure as Code
一貫性のある構成
スケーラビリティの向上
迅速なデプロイ
追跡可能性の向上
テンプレートにリソースを追加する
組み合わせの構文: resource-provider/resource-type
ex.: Microsoft.Storage/storageAccount
find resource providers
find each resource’s property


Azure でのIDとガバナンス
Azure Active Directory: MS のマルチテナントクラウドベースのディレクトリ及びID管理サービス。
アクセス先
企業ネットワーク上にある内部リソースとアプリ
MS365, Azure portal, SaaSアプリケーションなどの外部リソース
組織向けに開発されたクラウドアプリ
代表的な機能
SSO Access: クラウド上のWebアプリ及びオンプレミスのアプリへのセキュリティで保護されたSSOが提供される。ユーザーは同じ資格情報セットで全てのアプリにアクセス可能
ユビキタスデバイスのサポート: 各種デバイスから各種プラットフォームを通じてアプリを起動
セキュリティで保護されたリモートアクセス
クラウドへの拡張性
機密データの保護
セルフサービスのサポート
主要コンポーネント
ID: 認証できるオブジェクト
ユーザー名とパスワードを持つユーザー
秘密鍵または証明書を必要とするアプリケーションやサーバー
アカウント: データが関連づけられているID
Azure AD アカウント: Azure AD またはそれ以外のMSクラウドサービスを通じて作成されるID
Azure テナント: Azure ADの専用の信頼された単一のインスタンス。一つの組織
Azure サブスクリプション: 料金を支払うための単位
エディション

参加を実装: Azure Active Directoryを使うと任意の場所からデバイス、アプリケーション、サービスにシングルサインオンできる。SSOサポートのため、会社の資産が保護されデバイスがセキュリティとコンプライアンスの基準を満たしていることを確認する必要がある
利点
SSO: 余分な認証プロンプトがない
Enterprise State Roaming: ユーザーはユーザー設定とアプリ設定のデータを参加済みデバイスに安全に同期できる。新しいデバイスを構成する時間が短縮される
Windows Hello: 参加済みデバイスから仕事用リソースへのセキュリテイ保護沙r田便利なアクセスをユーザーに提供
アクセス制限: コンプライアンスポリシーを満たす参加済みデバイスからのみに制限
オンプレミスリソースへのシームレスなアクセス: デバイスからオンプレミスのドメインコントローラーへの通信経路がある場合、参加済みデバイスはオンプレミスのリソースにシームレスにアクセスできる
考慮すべきこと
接続オプション
デバイス自体を登録: 個人アカウントや職場アカウントを使用してデバイスにサインインできる
デバイスにサインインするIDを指定する
他のソリューションと組み合わせ: 
他の実装シナリオ
セルフパスワードリセット: 
特性と要件
SSPRオプションを管理するためにグローバル管理者特権を持つAzure ADアカウントが必要
SSPRではセキュリティグループを使用してSSPR特権を持つユーザーを制限
組織内のユーザーアカウント全てにSSPRを使用するためのy有効なライセンスが必要


Active Directory Domain Service: 物理または仮想サーバーへのWindows ServerベースのActive Directoryの従来デプロイ
代表サービス
Active Directory証明書サービス
Active Directoryライトウェイトディレクトリサービス
Active Directoryフェデレーションサービス
Active Directory Rights Managementサービス
AD DS vs Azure AD
AD DS
ディレクトリサービス
複数の認証
SAML
WS-Federation
Open ID Connect
Azure AD
完全なIDソリューション
HTTP及びHTTPS通信を使用するインターネットベースのアプリケーション向けに設計されている
Kerberos認証は使用されない
フェデレーションサービス及び多くのサードパーティサービスが含まれる
フラットな構造: ユーザーとグループ同格
管理サービス: ユーザー、グループ、ポリシーのみを管理
Azureでのストレージの実装と管理
Azureのコンピューティングリソースのデプロイと管理
Azure管理者向けの仮想ネットワークの構成と管理
