# Basics
    - LAN: Local Area Networ
    - WAN: Wide Area Network
    - バッチ処理: 
        - 処理するプログラムやデータなどをまとめて一括で処理する方式
    - ネットワークアーキテクチャ: 
        - 様々なプロトコルを体系的にまとめたもの
    - パケット通信: 
        - 大きなデータをパケットと呼ばれる単位に分割して送信する方法
    - プロトコルつの標準化
        - OSI: Open System Interconnection。ISOによって定められた通信体系
        - TCP/IP: IFTFによって提案、標準化されたプロトコル
    - プロトコルの階層化
        - インターフェース: 上位層と階層の間でサービスのやり取りをする時の約束事
        - 7 アプリケーション: 
            - 特定のアプリケーションに特化
            - ファイル転送や電子メール
        - 6 プレゼンテーション:
            - 機器固有のデータフォーマット
            - データ形式に関する役割
        - 5 セッション
            - コネクションの確立、切断
            - データ転送に関する役割
        - 4 トランスポート
            - 両端ノード間のデータ転送の管理
            - 宛先のアプリケーションに確実に届ける役割
        - 3 ネットワーク
            - アドレスの管理と経路の選択
            - 宛先までデータを届ける
        - 2 データリンク
            - 直接接続された機器間でのデータフレームの識別と転送
            - 直接接続されたノード間
        - 1 物理
            - O/I を電圧の工程や光の点滅に変換する
            - ビットの列を電圧の工程や光の点滅に変換

# 通信処理
- ヘッダ: 
    - 自分の階層のプロトコル処理に必要な情報
    - 上位層から取得したデータにつける
- MACアドレス:
    - Media Access Control. 
    - 同じ通信媒体に接続された機器を識別するためのアドレス
- 通信方式の種類
    - コネクション型
        - データの送信を開始する前に送信ホストと受信ホスト間での回線の接続をする
        - データリンク: 物理的な通信回線
        - トランスポート: 論理的なコネクション
        - 例:
            - ATM
            - TCP
            - フレームリレー
    - コネクションレス型
        - コネククション確立の有無に関わらず、データの送受信を行う
        - パケット交換であることが多い
            - パケット交換
                - 回線に接続しているコンピュータが送信するデータを複数の子包に分け、転送の順番を待つ行列に並べる方法
                - 1つの回線を複数のユーザーで共有していてもそれぞれのパケットをどこに運ばなければならないか、どのコンピュータ間の通信かを区別することが可能
                - 送られてきたパケットをバッファに格納
                - ルータのバッファの容量が満たされると、パケットが喪失する
        - 例
            - IP
            - UDP
    - 通信相手の数による通信方式
        - ユニキャスト
        - ブロードキャスト
        - マルチキャスト
        - エニーキャスト
- アドレス: 通信の主体を特定するためのユニークな情報
    - MACアドレス
        - ネットワークインターフェースカードごとに製造者識別子と製造者内での製品番号、製品ごとの通番が付され、唯一性が担保される
        - 階層性なし
        - 転送表
            - データリンク層における各パケットの送付先を決めるための表
            - 目的: ルータ、スイッチがパケットを転送するための情報を提供
            - 機能: ルータやスイッチがパケットが受信したパケットを経路制御表に基づいて正しいポートまたは次のホップへ転送するために使用
            - 情報: 転送表には特定の宛先IPアドレスまたはMACアドレスとそれに対する転送ポートまたは次のホップ情報
            - 管理: ルータやスイッチが転送テーブルを保持し、パケットの転送に使用
    - IPアドレス
        - ネットワーク部とホスト部から構成
        - 同じネットワーク部を持つものは同じ組織やグループに接続
        - 階層性あり
        - 経路制御表
            - ネットワーク層における各パケットの送付先を決めるための表
            - 目的: ルーティングのための情報を提供
            - 機能: ネットワーク内の異なるノードやサブネットワークに到達するための最適な経路を決定するために使われる
            - 情報: ネットワーク内の異なるノードやネットワークセグメントへの経路情報が含まれており、通常はIPアドレス、サブネットマスク、次のホップルーターなどの情報が含まれる
            - 管理: ルータが経路制御表を保持し、ネットワークトラフィックの経路を決定するために使用
- ネットワーク構成要素
    - 通信媒体とデータリンク
        - データリンク
            - イーサネット
            - 無線
        - bps
            - Bits Per Second. 2つの機器間を流れるデータリンクの伝送速度が大きくなった場合、短い時間でより多くのデータを送ることができる
    - ネットワークインターフェース
        - ネットワークに接続するための専用のインターフェース
        - 有線LAN
            - NIC
            - USB-Ethernet
            - ネットワークアダプタ
        - 無線LAN
            - Wi-Fi
    - リピーター
        - OSI参照モデルの第一層の物理そうでネットワークを延長する機器。
        - ケーブル上を流れてきた電気や光の信号を受信し、増幅や波形の整形などをしたのちに別の側へ再生
    - ブリッジ/レイヤ２スイッチ
        - OSI参照モデルの第2層、データリンク層でネットワーク同士を接続する装置
        - データリンクのフレーム(パケット)を認識してブリッジ内部のメモリに一旦蓄積し、接続された相手側のセグメントに新たなフレームとして送出
        - 伝達速度が異なるデータリンクを接続できる
            - フレームを一旦蓄積するため
        - FCS
            - Frame Check Sequence. CRC方式によってフレームチェックするために利用されるフィールド。
            - ノイズなどにより通信途中でフレームが壊れていないかをチェックする
        - 無駄なトラフィックを流さないように制御
            - アドレスの学習機能により
            - フィルタリング機能
        - ラーニングブリッジ
            - パケットを隣のセグメントに流すかどうかの判断を行う機能
            - 一度そのブリッジを通過したフレームのMACアドレスは一定時間ブリッジ内部のテーブルに登録され、どのセグメントにどのMACアドレスを持つ機器が存在するかを判断する仕組み
        - スイッチングハブ
            - ブリッジの機能を持ったハブ
            - ケーブルを接続するポート全てがブリッジになっているかのように機能する
    - ルータ/レイヤ3スイッチ
        - ネットワークとネットワークを接続してパケットを中継する装置
        - IPアドレスで処理
        - 異なるデータリンクを相互に接続可能
        - ネットワークの負荷を仕切る役割
        - セキュリティの機能
        - ネットワーク全体の経路を判断し、宛先へ転送
    - レイヤ4~7スイッチ
        - OSI参照モデルのトランスポート層からアプリケーション層の情報に基づいて配送処理を行う
        - ロードバランサー
            - レイヤ4~7スイッチの一種。1つのURLで複数のサーバーに負荷を分散させる
        - サイト
            - URLで指しているインターネットに接続されたサーバー
        - 帯域制御
            - 即応性に応じて通信処理の優先順位を決める
        - ゲートウェイ
            - 異なるプロトコルを持つネットワーク同士の中継、データの交換機能を持つ
            - アプリケーションゲートウェイ
                - ゲートウェイの一種。同一プロトコル間の中継をするもの。
            - プロキシサーバー
                - ゲートウェイの一種。ネットワークトラフィックの軽減やセキュリティを意図した代理サーバー
- 実際のネットワークの構成
    - コア-エッジ-アクセス-家庭や企業

# TCP/IP
- TCP/IP標準化の精神
    - オープン: IETFを通した意思決定
    - 標準化するプロトコルが実際に使えるプロトコルとして重視されたこと
    - TCP/IP仕様書
        - RFC
            - Request For Comments
            - ドキュメントとしてインターネット上で公開される
            - プロトコルの実装や運用に関する有用な情報
            - プロトコルの実験に関する情報
        - FYI
            - For Your Information
            - プロトコルの実装や運用に関する有用な情報
- 基礎知識
- Intranet
    - 組織内部において閉じた通信サービスを行うこと
- NOC
    - Network Operation Center
    - ネットワーク区間の接続部
- IX
    - Internet Exchange
    - ネットワークの運用者や運用方針、利用方針、などが異なるネットワークを対等に接続するポイント
- ISP
    - Internet Service Provider
- 地域ネット
    - 特定の地域で自治体やボランティアなどにより運営されているネットワーク
- OSI参照モデル: 通信プロトコルに必要な機能は何か
- TCP/IP階層モデル: プロトコルをコンピュータに実装するにはどのようにプログラムすれば良いか
    - ハードウェア: ネットワーク上で物理的にデータを転送してくれる
    - ネットワークインターフェース層
        - イーサネットなどのデータリンクを利用して通信するためのインターフェース
        - NICを動かすためのデバイスドライバ
            - NIC
                - Network Interface Card
                - CP-NIC-Network Internet
    - インターネット層
        - IP
            - ネットワークを跨いでパケットを配送し、インターネット全体にパケットを送り届けるためのプロトコル
            - 各ホストを識別するためにIPアドレスを使用
            - データリンクの特性を隠す
            - 信頼性のないパケット交換プロトコル
        - ICMP
            - Internet Control Message Protocol
            - IPパケットの配送中に何らかの異常が発生してパケットを転送できなくなった場合に、パケットの送信元に異常を知らせるためのプロトコル
        - ARP
            - Address Resolution Protocol
            - パケットの送り先の物理的なアドレスをIPアドレスから取得するプロトコル
    - トランスポート層
        - アプリケーションプログラム間の通信を実現
        - ポート番号
            - アプリケーションプログラムの識別子
        - TCP
            - Transmission Control Protocol
            - コネクション型で信頼のあるプロトコル
        - UDP
            - User Datagram Protocol
            - コネクションレス型で信頼性のない
            - パケット数が少ない通信やブロードキャストマルチキャスト通信、ビデオや音声などのマルチメディア通信に向く
    - アプリケーション層
        - クライアント/サーバーモデル
            - クライアントからの要求がいつきてもいいようにサーバープログラムは常に稼働
            - サーバー: サービスを提供するプログラム
            - クライアント: サービスを受けるプログラム
        - WWW
            - World Wide Web
            - インターネットで情報をやり取りする仕組み
        - HTTP
            - Hyper Text Transfer Protocol
            - ブラウザとサーバー間の通信で使われる
        - HTML
            - Hyper Text Markup Language
            - 送信に使われる主なデータフォーマット
        - Email
            - SMTP
                - Simple Mail Transfer Protocol
                - 電子メールの転送に利用されるプロトコル
            - MIME
                - MultiPurpose Internet Mail Extensions
                - インターネットで幅広く使えるようにメールのデータ形式を拡張したもの
        - FTP
            - File Transfer Protocol
            - ファイル転送のプロトコル
            - バイナリモードやテキストモードを使用したファイル転送
            - TCPコネクションの確立
                - 制御コネクション
                - データコネクション
        - 遠隔ログイン
            - 遠く離れたコンピュータにログインしてそのコンピュータでプログラムを走らせる機能
            - TELNET
            - SSH
        - SNMP
            - Simple Network Management Protocol
            - ネットワーク管理に使用
            - エージェント: SNMPで管理されるルータやブリッジ、ホスト
            - マネージャ: SNMPでネットワーク機器を管理するマネージャ
- TCP/IP階層モデルと通信例
    - ヘッダ: プロトコルのための情報
    - データ: 送信される情報
    - パケット: データ
    - フレーム: データリンクのパケット
    - セグメント: ストリームベースのTCPに含まれるデータ
    - データグラム: ネットワーク層以上でパケット単位のデータ構造を持つプロトコル
    - メッセージ: アプリケーションプロトコルのデータ単位
    - TCPモジュールの処理
        - アプリケーションの指示により、コネクションの確立、データ送信、コネクションの切断
        - TCPヘッダ
            - ポート番号: 送信ホスト、受信ホストのアプリケーションを識別
            - シーケンス番号: パケットのデータが何バイト目のデータかを示す
            - チェックサム: データが壊れていないことを保証する方法
    - IPモジュールの処理
        - IPヘッダ
            - 宛先のIPアドレス
            - 送信元のIPアドレス
            - TCP/UDP
        - 処理手順
            1. IPパケット完成
            1. ルーティングテーブルを参照して、IPパケットを次に受け渡すルータやホストを決定
            1. ネットワークインターフェースのドライバにIPパケットを渡す
            1. 送信処理
        - ARP
            - Address Resolution Protocol
            - 通信先機器のMACアドレスを調べる
    - ネットワークインターフェースの処理
        - ヘッダ
            - 宛先のMACアドレス
            - 送信元のMACアドレス
            - イーサネットタイプ
        - FCS
            - Frame Check Sequence
            - 送信処理中にハードウェアで計算されパケットの最後につけられる
            - ノイズによりパケットが破壊されたことを検出

# 各層
- データリンク層
    - データリンク層のプロトコル: 通信媒体で直接接続された機器間で通信するための仕様
    - MACアドレス: データリンクに接続しているノードを識別するために利用
        - IEEE: 米国電気電子技術者協会
        - 48ビット
            - 1: ユニキャストアドレス/マルチキャストアドレス
            - 2: ユニバーサルアドレス/ローカルアドレス
            - 3~24: IEEEがベンダごとに重ならないように管理するアドレス
            - 25~48: ベンダが製品ごとに重ならないように管理するアドレス
    - 媒体共有型
        - 通信媒体を複数で共有するネットワーク
        - 初期のイーサネット
        - FDDI
        - 通信の優先権を制御する仕組み
        - コンテンション方式: 
            - データの送信権を競争で奪い取る方式
            - 同時送信時、データ破損
            - CSMA
                - Carrier Sense Multiple Access
                - 送信を試みる前に別のノードからのキャリア信号の存在の検出を試みることで、現在通信しているホストが他にあるかどうかを確認
            - CSMA/CD
                - 衝突を早期に検出して、素早く通信路を開放する
                - 搬送波が流れていなければデータ送信可
                - 衝突検知時、ジャム信号を送信し送信取り止め
                - 乱数時間待って送信をやり直す
        - トークンパッシング方式
            - トークンと呼ばれるパケットを巡回させ、このトークンで送信権を制御
            - トークンを持っているステーションだけが送信可能
            - トークンが回ってくるまでデータ送信不可
            - 混雑していない時にデータリンクの性能を100%引き出せない
    - 媒体非共有型
        - 通信媒体を共有せずに占有する方式
        - ステーションはスイッチと呼ばれる装置に直接接続され、そのスイッチがフレームを転送する
        - 通信方式
            - 半二重通信
                - 送信をしている間は受信できず、受信をしている間は送信できないような通信
                - 無線のような感じ
            - 全二重通信
                - 送信と受信を同時に行える通信
                - 電話のような感じ
        - 大体は全二重通信
        - スイッチに高度な機能を持たせることで、仮想的なネットワークの構築やデータ流量の制御なども可能になる
        - スイッチが故障するだけで接続されたすべてのコンピュータ間の通信が不可能になってしまうという欠点がある
    - MACアドレスによる転送
        - イーサネットスイッチ
            - 複数の浦オートを持ったブリッジ
            - 各フレームの通過点では、そのフレームの宛先MACアドレスをみて、どのインタフェースから送り出すかを決める
                - 転送表: その際に参照する、送出インタフェースを記したテーブルのことを
                    - 手動でここの端末やスイッチに設定するのではなく、自動的に生成される。
                    - 自動学習: データリンク層の各通過点は、パケットを受け取った時にそのパケットの送信元MACアドレスとそのパケットを受け取ったインタフェースの対を転送表に書き込む
                        - これにより、そのMACアドレスを宛先とするパケットを受け取った場合そのインタフェースから送り出せば良いとわかる
                    - 階層性がない
                        - 転送表のエントリは、そのデータリンク内に存在する機器の数だけ必要
                        - 多くの端末を繋げる場合には、複数のデータリンクに分、ネットワーク層でIPアドレスのような階層的なアドレスを使って束ねる必要がある
            - スイッチの転送方式
                - ストア & フォワード: イーサネットフレーム末尾のFCSをチェックしてから転送を行う
                    - 衝突によって壊れたフレームや、ノイズによるエラーフレームは転送しない利点がある
                - カットスルー: フレームを全部蓄積し終わる前に処理が始まり、送信先のMACアドレスが分かり次第データの転送を開始する
                    - 遅延時間が短い
                    - エラーフレームを転送する可能性あり
    - ループを検出するための技術
        - ブリッジでネットワークを接続するときにループを作った場合、メルトダウンが発生
            - メルトダウン: 異常なパケットがネットワークを埋め尽くし、通信不能になる状態。
                - 多くの場合、原因となっている機器の電源を切ったり、ネットワークから切り離したりしない限り状態は回復しない
        - スパニングツリー: 
            - この機能を持つブリッジを使う場合に限り、ブリッジでループのあるネットワークを構成しても問題なく通信できる
            - 適切な形でループを作れば、トラフィックを分散させたり、経路の一方に障害が発生したときにフレームを迂回させたりして、耐障害性を高めることが可能
            - 各ブリッジは1~10秒の間隔で、BPDUを交換する。
                - BPDU: Bridge Protocol Data Unit。パケットの一種
            - 通信に使用するポートとしないポートを消すように制御する
            - 障害が発生した場合には、通信路が自動的に切り替わり、使用されていないポートを使って通信が行われるようになる
            - 具体的に
                - ある一つのブリッジをルートとするツリーを構成する。
                - それぞれのポートに適切に重みをつけることで、優先して使いたいポートと障害時に使いたいポートを指定できる
            - コンピューターやルーターの機能に関係なく、ブリッジの機能だけでループを解消できる
            - RSTP: Rapid Spanning Tree Protocol
                - 障害時の切り替わりにかかる時間を数秒以下に抑えられる
        - リンクアグリゲーション
            - LANスイッチ間を複数のリンクで接続することで、障害体制の向上と高速化を実現する仕組み
            - 複数のポートを同時に使用できる
        - LLDP
            - Link Layer Discovery Protocol
            - ネットワークにつながっている機器の情報を収集する仕組み
            - ネットワーク機器は自身のホスト名や機器情報、ポート/インタフェース情報を定期的にマルチキャストMACアドレスに送信
            - 情報を収集する機器はLLDPパケットを受信することで情報を収集
            - ネットワークに接続された機器情報を簡単に確認できる
    - VLAN
        - Vertual LAN
        - VLAN技術を利用できるブリッジを使うことで、ネットワークの配線を変えずに、ネットワークの構造を変えることができる
        - ブリッジ/レイヤ2スイッチの機能
        - 異なるVLAN間のすべての通信を遮断
            - 余分なパケットが流れず、効率的な運用が可能
        - 基本構造
            - スイッチのポートごとにセグメントを分ける
                - ブロードキャストのトラフィックが流れる範囲を区切ることができる
                    - ネットワークの負荷を軽減する
                    - セキュリティを向上させる
                - 異なるセグメント間で通信するためには
                    - ルータの機能を備えたスイッチを利用
                    - セグメント間をルータで結ぶ
                    - タグVLAN
                        - VLANを拡張し、異なるスイッチを跨いだセグメントを構築できるようにしたもの
                        - セグメント毎に一意となるVLAN IDを設定
                        - スイッチ間でフレームを転送するときにはイーサネットのヘッダの中にVLANタグを挿入し、その値を元にしてどのセグメントにフレームを転送するかを決定する
        - 物理的なネットワーク構成と、論理的な構成が異なるため
            - わかりにくい
            - 管理しにくい
    - Ethernet
        - 最も普及している
        - 他のデータリンクと比べて制御の仕組みが単純なため、NICやデバイスドライバが作りやすい
        - 高速ネットワークへの対応
        - 普及当初は、複数ん末での1本同軸ケーブルを共有する媒体共有型の接続が一般的
        - 端末とスイッチの間を占有のケーブルで接続して、イーサネットプロトコルで通信する形態
        - フレームフォーマット
            - プリアンブル: 
                - ここからイーサネットフレームが始まることを示し、相手のNICと同期を取れるようにするもの
                - 1と0を交互に並べた、8オクテットのフィールド
                - SFD: start frame delimiter 末尾のみ11
            - フレーム本体の先頭にくるヘッダ
                - 宛先MACアドレスのフィールド: 6オクテット
                - 送信元MACアドレスのフィールド: 6オクテット
                - 上位層のプロトコル種類を表すフィールド: 2オクテット
            - フレーム本体
            - FCS: Frame Check Sequence
                - 4オクテットのフィールド
                - フレームが壊れていないかどうかをチェック
                - 通信中に電気的なノイズが発生すると、送信したフレームがビット化けを起こして壊れる可能性あり
                - フレーム全体を特定のビットれるで割った甘利を格納
                - 受信側でも同じ計算を行い、FCSの値が同じになったらフレームが正しく届いたと判断する
    - 二つの階層に分けられる
        - 媒体アクセス制御: イーサネットやFDDIなどのデータリンク毎に決まっているヘッダ制御
        - 論理リンク制御: 共通になっているヘッダや制御のこと
    - 無線通信
        - 種類: 通信距離に応じた分類
            - 無線PAN: Bluetooth
            - 無線LAN: Wi-Fi
            - 無線MAN: WiMAX
            - 無線RAN
            - 無線WAN: 3G, LET, 4G
        - IEEE802.11
            - 無線LANプロトコルの物理層とデータリンク層の一部を定義した規格
            - CSMA/CA: 
                - アクセス制御方式の一種
                - Carrer Sense Multiple Access with Collision Avoidance
                - 無線LANが利用する電波は有限であり、複数の端末が同じ周波数帯を共有する必要がある媒体共有型のネットワーク
                - Carrier Senseによりデータを送信して良い状態稼働かを確認し、ランダムな時間だけを待ってからデータ送信を開始することで衝突を回避する仕組み
    - PPP
        - Point to Point Protocol
        - 1to1でコンピュータを接続するためのプロトコル
        - データリンクプロトコル
        - 純粋なデータリンク層
        - データ通信を開始する前にPPPレベルでコネクションを確立する
            - 認証
            - 圧縮
            - 暗号化
        - 機能
            - LCP
                - Link Control Protocol
                - 上位層に依存しない
                - コネクションの確立や、切断、パケット長の設定、認証プロトコルの設定、通信品質の監視をするかどうかなどの設定
            - NCP
                - Network Control Protocol
                - 上位層に依存する
                    - IPCP
                        - IP Control Protocol
                        - IPアドレスの設定やTCP/IPのヘッダ圧縮
        - 通常ユーザーIDやパスワードによる認証が行われる
            - 通信する双方向で認証を行える
            - PAP
                - Pasword Authentication Protocol
                - PPPのコネクションの確立時に1回だけIDとパスワードのやり取りをする方法
                - やりとりするパスワードは暗号化されずに平文のまま送信される
            - CHAP
                - Challenge Handshake Authentication Protocol
                - 毎回パスワードが変更されるOTPを使用する
                - コネクション確立後も定期的にパスワードを交換することにより通信相手が途中から入れ替わっていないかどうかをチェック
        - フレームフォーマット
            - フラグがフレームの区切りを示す
                - HDLC
                    - High Level Data Link COntrol Procedure
                    - フラグシーケンスによってフレームの区切りを示す
                        - 01111110
                        - フレーム内部において1が6回以上連続することを許さない。そのためフレームを送信するときに1が5回以上連続した場合には直後に0を挿入する必要があり、受信時にはその0を削除する必要がある
                        - そのためCPUに大きな負荷がかかる
        - PPPoE
            - PPP over Ethernet
            - イーサネット上でコネクションを管理
            - PPPの認証機能などを利用してプロバイダが顧客の管理をしやすくなる
    - そのほか
        - ATM
            - Asynchronous Transfer Mode
            - データを「ヘッダ5オクテット」+「データ48オクテット」のセルと呼ばれる単位で処理するデータリンク
            - 回線の専有時間を短くすることにより大容量のデータを効率よく転送できるようにしている
            - 広域を結ぶネットワークで利用される
            - コネクション型
            - 同時に複数の相手と通信回線を接続することができる
            - 送信権の制御がない
                - すべてのコンピュータが同時に大量のデータを送信すると、ネットワークが混雑して輻輳状態になる
                    - 輻輳: ネットワークが非常に混雑して、ルータやスイッチがパケットやセルを処理しきれなくなった状態。処理しきれなくなったパケットやセルは破棄される
                - これを防ぐため、ATMには帯域をきめ細かく制御する機能が備えられている
            - 非同期多重
                - ヘッダで宛先を明らかにすることにより、必要なときに転送を行う
                - 回線の利用効率は上がるが、ヘッドの分オーバヘッドとなり実際の通信速度が低下する
                - VS 同期多重
            - 48オクテットのデータしか送れないため、上位層のデータはほとんど送ろことができない
                - AAL
                    - ATM Adaption Layer
        - POS
            - Packet over SDH/SONET
            - デジタル信号を光ファイバーでやりとり捨ための物理層の規格であるSDH（SONET）上でパケット通信を行うためのプロトコル
                - SDH: Synchronous Digital Hierarchy
                - SONET: Synchronous Optical NETwork
            - 電話回線や専用線などで信頼性の高い光伝送ネットワークとして広く利用される
        - ファイバーチャネル
            - 高速なデータチャネルを実現するデータリンク
            - 周辺機器を接続するバスに近い仕組み
        - iSCSI
            - パソコンなどにハードディスクを接続するための標準規格であるSCSIをTCP/IPネットワーク上で利用する規格
            - SCSIのコマンドとデータをIPパケットに包含し、データの送受信を行う
            - パソコンなどの内蔵SCSIハードディスクと同様に、ネットワーク上に直結された大規模ハードディスクを利用することが可能
        - InfiniBand
        - IEEE1394
        - HDMI
            - High-Definition Multimedia Interface
            - 1つのケーブルで高品位な映像と音声をデジタル伝送できる規格
        - DOCSIS
        - 高速PLC
    - 公衆アクセス網
        - アナログ電話回線
            - 固定電話回線を利用して通信を行う
            - 電話回線の音声部分の帯域を使ってインターネットにダイアルアップ接続する場合に利用される。
            - コンピュータとアナログ電話回線で接続するためには、デジタル信号とアナログ信号を変換するモデムが必要になる
        - モバイル通信サービス
            - PHS: Personal Handyphone System
            - MIMO: Multiple-Input and Multiple-Output
            - キャリアアグリゲーション: 複数の周波数帯の電波を束ねてデータ通信を行う技術
        - ADSL
            - Asymmetric Digital Subscriber Line
            - 既存のアナログ電話回線を拡張利用するサービス
            - 電話機と電話局の交換機の間の回線を利用
            - スプリッタと呼ばれる分配器を設置し、音声周波数とデータ通信用の周波数を金剛・分離する
        - FTTH
            - Fiber To The Home
            - 高速の光ファイバーをユーザーの自宅や会社の建物内に直接引き込む手法
            - ONUと呼ばれる装置により光を電気信号に変換してからコンピュータやルータに接続する
        - ダークファイバー
            - 通信事業者や送配電事業者などの社会インフラ関連業者などが敷設した光ファイバーケーブルのうち、使用していない光ファイバーを一般企業や団体が借り受けて提供されるサービス
        - ケーブルテレビ
        - 専用線
        - VPN
            - Virtual Private Network
            - IP-VPN
                - IPネットワークにVPNを構築する
                - ラベルと呼ばれる情報をIPパケットに付加して通信を制御する
                - このラベルを顧客毎に異なるように設定し、MPLS網を通過する際に、このラベルで宛先の判断を行う
                - IPsec
                    - VPN上での通信時にIPパケットの認証、暗号化を行い、インターネット上で閉じたネットワークを構築する
            - 広域イーサネット
                - 通信事業者が提供する、離れた地域を結ぶイーサネット接続のサービス
                - データリンク層であるイーサネットを用いたVLANを利用する
                - TCP/IP以外のプロトコルを使用可能
                - 通信事業者が構築するネットワークのVLANを利用企業が専用で利用する形になる
                - 同じVLANを指定すればどこからでも同じネットワークに接続できる
            - SD-WANサービス
                - WANを構成するMPLSやインターネット、4GLTEなどを取りまとめ、仮想的なWANリンクを構成するサービス
                - 論理ネットワークを構成することが可能
            - 公衆無線LAN
                - Wi-Fiを利用したサービス
- ネットワーク層
    - 主にIPとICMPの2つのプロトコルから構成される
    - 終点ノード間の通信を実現する
    - データリンクを超えた通信をするためにはネットワーク層が必要
        - 通信経路になっているデータリンクの違いをおおい隠し、異なる種類のデータリンクであったとしても、その間の連携をとりながらパケットを配送することによって、別のデータリンクに接続されているコンピュータ間での通信を可能にする
    - ホスト: IPアドレスが付けられているが経路制御を行わない機器や機会、装置のこと
    - ルーター: IPアドレスが付けられていて経路制御を行う機器
    - ノード: ホストとルーターの総称
    - IPアドレス
        - ネットワークに接続されているすべてのホストの中から、通信を行う宛先を識別する
        - TCP/IPで通信するすべてのホストやルーターには、IPアドレスを設定する必要がある
    - 経路制御
        - ルーティング
        - 宛先IPアドレスのホストまでパケットを届けるための仕組み
        - hop: ネットワークの1区間をIPパケットが跳ぶこと
        - ホップバイホップルーティング
            - ルータやホストはIPパケットに次の転送先となるルータやホストを指示するだけで、最終目的地までの経路を指示するわけではない
            - ad hoc: 行き当たりばったり
        - ルーティングテーブル
            - IPパケットを次にどのルーターへ送ればよいかが記載されている
    - データリンクの抽象化
        - 複数のデータリンクで接続されたネットワーク間の通信を実現するプロトコル
        - MTU
            - Maximum Transimission Unit
            - 最大転送単位
        - データリンクのMTUもその種類によって異なる
        - 分割処理
            - 大きなIPパケットを複数の小さなIPパケットに分割する処理
            - 分割されたパケットは宛先のホストで再び1つにまとめられ、IPの上位層に渡される
    - コネクションレス型
        - パケットを送信する前に通信相手との間にコネクションの確立を行わない
        - 上位層に送信すべきデータが発生し、IPに送信要求をしたら、すぐにIPパケットにデータを詰めて送信する
        - 機能の簡略化と高速化のため
        - ベストエフォート型: パケットを宛先まで送り届けようと最大限の努力をするが、確実に届く保証はない
        - 信頼性をTCPに求めることで、プロトコルの役割分担を明確化し、より簡潔に早く機能の実装が可能
    - IPアドレス
        - IPv4
            - 32ビットの正整数値
            - 2**32 = 約43億台のコンピュータをIPネットワークに接続できる
            - IPアドレスはホスト毎ではなく、NICごとに割り当てることになる。複数割り当ても可能
            - 通常ルータは2つ以上のNICを持つため、2つ以上のIPアドレスを持つことになる
            - ネットワーク部
                - データリンクのセグメント毎に重ならない値を割り当てる
            - ホスト部
                - 同一セグメント内で重ならない値を割り当てる
            - IPパケットが途中のルーターで転送されるときには、宛先IPアドレスのネットワーク部が利用される。
            - ネットワーク部とホスト部の見分け方
                - 初期IP
                    - クラスによる区分け
                    - 4つのクラス: 
                        - クラスA: IPアドレスの先頭1ビットが0で始まる場合、先頭から8ビットまでがネットワーク部
                        - クラスB: IPアドレスの先頭2ビットが10で始まる場合、先頭から16ビットまでがネットワーク部
                        - クラスC: IPアドレスの先頭3ビットが110で始まる場合、先頭から24ビットまでがネットワーク部
                        - クラスD: IPアドレスの先頭4ビットが1110で始まる場合、先頭から32ビットまでがネットワーク部
                            - IPマルチキャスト通信に使われる
                - 現在
                    - サブネットマスク
            - ブロードキャストアドレス
                - 同一リンクに接続されたすべてのホストにパケットを送信するためのアドレス
                - ホスト部のビットをすべて1にする
                - ローカルブロードキャスト
                    - 自分が属しているリンク内のブロードキャスト
                - ダイレクトブロードキャスト
                    - 目的のネットワークに属する全ホストに対するブロードキャスト
            - マルチキャスト
                - 特定のグループに属するすべてのホストにパケットを送信する
                - 信頼性はない
                - マルチキャスト機能が使用されるまではブロードキャストで全端末にパケットを送信し、受信したホストのIPより上の層で自分に必要なデータかいなかの判断を行い、必要であれば受け取り、必要でなければ破棄する方法が使われている
            - サブネットマスク
                - サブネットマスクと呼ばれる識別子が導入され、クラスのネットワークを小さく区切るサブネットワークアドレスが利用される
                - クラス毎に決まるホスト部をサブネットワークアドレス部として使うことにより、複数の物理ネットワークに分割できるようにする
                - IPアドレスのネットワーク部を表すビットと同じ桁の部分が1となり、ホスト部の部分は0となる
                - とりま2進数で考えよう
            - CIDR
                - 任意のビット長でIPアドレスを配布するようになった
                - Classless InterDomain Routing
                - クラスに縛られない組織間の経路制御
            - 可変長サブネットマスクVLSM
                - Variable Length Subnet Mask
                - 組織内の部署毎にネットワークアドレス長を変えられるようにする仕組み
            - プライベートアドレス
                - インターネットに接続しない独立した私的なネットワークで利用できるIPアドレス
                    - 10/8
                    - 172.16/12
                    - 192.168/16
                - NAT
                    - プライベートIPアドレスとグローバルIPアドレスの間でアドレスを変換する技術
                    - プライベートアドレスを割り当てたネットワーク上のホストから、グローバルアドレスを割り当てたインターネット上のホストと通信できるようになった
                    - 家庭や学校、企業内ではプライベートIPアドレスを設定し、インターネットと接続するルーターやインターネットに公開しているサーバーにだけグローバルIPアドレスを設定することが一般化している
            - ICANN
                - Internet Corporation for Assigned Names and Numbers
                - グローバルIPアドレスを一元管理
                - 今まではユーザーがJPNICから直接グローバルIPアドレスを取得する必要があったが、現在はISPにインターネットへの接続を依頼するとき、同時にグローバルIPアドレスの申請も依頼できる
            - 経路制御
                - 通信するホストやルーターなどの機器は必ず経路制御表を持つ
                - 経路制御表の作成
                    - 静的経路制御
                        - 管理者が事前に設定する方法
                    - 動的経路制御
                        - ルーターが他のルータと情報を交換して自動的に作成
                        - ネットワークに接続されたルーター間で経路制御情報のやり取りができるように、正しくルーティングプロトコルを設定しなければならない
                - 手順
                    - 経路制御表には、ネットワークアドレスと、次に配送すべきルーターのアドレスが書かれている
                    - IPパケットを送信するときは、IPパケットの宛先アドレスを調べて経路制御表から一致するネットワークアドレスを検索し、対応する次のルーターに配送する
                        - 経路制御表に一致するネットワークアドレスが複数ある場合は、一致するビット列が長い方のネットワークアドレスを選択する
                    - 次に配送すべきルーターのアドレスが記載されている場所にそのホストやルーター自身のネットワークインターフェースのIPアドレスが記載されている場合、「宛先のホストが同一データリンクに接続されている」ことを意味する
                - デフォルトルート
                    - 経路制御表に登録されているどのアドレスにもマッチしない場合の経路
                    - 0.0.0.0/0
                    - default
                - ホストルート
                    - IPAddress/32
                    - IPアドレスの全てのビットを使って経路制御する
                    - 何らかの都合によりネットワークアドレスによる経路制御を利用したくない場合に用いる
                    - 多用すると経路制御表が大きくなり、ルーターの負荷が増大してネットワークの性能が低下する原因になる
                - ループバックアドレス
                    - 同じコンピューター内部のプログラム間で通信したい場合に用いる
                    - 127.0.0.1
                    - localhost
                    - パケットはネットワークに流れない
                - リンクローカルアドレス
                    - ルーターを超えない同一リンク内の通信のために169.254/16を用いる
                    - 固定IPが設定されていないホストで、DHCPによるIPアドレスの取得ができなかった場合に設定される
                    - ホスト部はランダムに決まる
                    - ルーターによる転送を禁止する
                - 経路制御表の集約
                    - ネットワークアドレスのビットのパターンを考えて階層的に配置すると、内部的には複数のサブネットワークから構成されたとしても、外部には代表する1つのネットワークアドレスで経路制御する
                    - 192.168.2.0/23
                        - 192.168.2.0/24
                        - 192.168.3.0/24
            - データリンクによってMTUが異なるため、IPは上位層として適切に抽象化する必要がある
                - ホストやルーターはデータリンクのMTUに合わせてIPデータグラムの分割処理をする
                - IPヘッダには、分割された断片の位置とそのパケットの後に断片が続いていることを示すフラグがある。このフラグで断片の始まりか、中間か、終わりがある
                - 分割されたIPデータグラムを元のIPデータグラムに戻す再構築の処理は、終点の宛先ホストだけで行われる。
                - 途中のルータは分割処理は行うが、再構築処理は行わない
                    - 分割したIPデータグラムが同じ経路を通って届く保証はない
                    - 途中で再構築しても、別のルーターを通る時に分割処理する必要が出てくる可能性がある
                - 経路MTU探索
                    - 分割処理の欠点
                        - ルーターの処理が重くなる
                        - 分割された断片の1つが失われただけでIPデータグラムの全てが失われること
                    - 送信先ホストから宛先ホストまで分割処理が必要にならない最大MTU
                    - 経路に存在するデータリンクの最小MTU
                    - 経路MTUを発見し、送信元のホストで経路MTUの大きさにデータを分割してから送信する方法
                    - 処理順序
                        - IPヘッダの分割禁止フラグを設定して送信する。ルーターでパケットが失われる
                        - ICMPによって次のMTUの大きさを知る。
                        - TCPの再送処理によってデータが再送される。この時TCPがIPで分割されない大きさに区切ってからIP層に渡す。IPでは分割処理は行われない。
                        - 再構築は不要。データはそのままTCP層へ渡される。
                    - ICMP
                        - Internet Control Message Protocol
                        - TCP/IPでネットワークの疎通がされているノード（サーバー、ネットワーク機器、PCなど）間で、通信状態の確認をするために使われるプロトコル。ICMPは、OSI参照モデルのネットワーク層で動作し、IPプロトコルに含まれるプロトコル。
                        - ICMPは、死活監視や可用性監視と呼ばれる「Ping監視」を行うためのプログラムに使われます。Ping監視では、ICMPによりテストパケットが監視対象のノードに送付され、その応答により監視ノードの状態を把握します。つまり、ICMPによって「監視ノードが存在するか」「監視ノードと通信可能か」などを調べることができます。多くの場合、例えば「Ping監視に5回返答がなければ故障というメッセージを管理者に送付する」というように、しきい値とそれに伴うアラート発報などと一緒に運用されることが多いです。
            - IPv4ヘッダ
                - IPプロトコルによってパケットの配送を制御する時に必要になる情報が格納されている
                - 構成要素
                    - version
                        - IPヘッダのバージョン番号
                        - 4bits
                    - ヘッダ長
                        - IPヘッダ自体の大きさ
                        - 4octets
                        - without options, 20 octets
                    - DSCP
                        - Differentiated Services Codepoint
                        - DiffServと呼ばれる品質制御で利用
                        - クラスセレクターコードポイント: ビット3~5、ビット0~2は
                        - ビット5が1の時、実験用、ローカル利用の設定
                        - ECN
                            - Explicit Congestion Notification
                        - ECT
                            - ECN-Capable Transport
                            - 上位層のトランスポートプロトコルがECNに対応しているかどうかを通知する
                            - ルーターは、ECNが1になっているパケットを転送するとき、輻輳が発生していたらCEを1にする
                    - サービスタイプ
                        - 元々考えられていた制御機構を実装するのが難しかったことや、不正に設定されると意味がなくなる可能性があったため運用されていない
                    - パケット長
                        - IPヘッダとIPデータを加えたパケット全体のオクテット長を表す
                        - 最大サイズ: 65535オクテット
                    - 識別子
                        - 16ビットで構成
                        - フラグメントを復元する際の識別子として使われる
                        - 同じフラグメントでは同じ値、違うフラグメントでは違う値になるように処理される
                        - 通常、IPパケットを送信するたびに1つずつ増やす
                    - フラグ
                        - 3ビット
                        - パケットの分割に関する制御
                    - フラグメントオフセット
                        - 13ビット
                    - 生存時間
                        - 8ビット
                        - パケットがネットワークに存在して良い時間を秒単位で示したもの
                        - 実際のインターネットでは何このルータを中継してもよいか
                        - 0になったら破棄
                    - プロトコル
                        - 8ビット
                        - IPヘッダの次のプロトコルが何であるかを示す
                    - ヘッダチェックサム
                        - 16bits
                        - IPヘッダのチェックサムを表す
                            - チェックサム
                                - IPヘッダが壊れていないことを保証するためのもの
                    - 送信元IPアドレス
                    - 宛先IPアドレス
                    - オプション
                    - パディング
                    - データ
        - IPv6
            - IPv4アドレスの枯渇問題を根本的に解決するために標準化されたインターネットプロトコル
            - 16オクテット
            - IPアドレスの拡大と経路制御表
                - IPアドレスの構造をインターネットに適した階層構造にする。そしてアドレス構造に適するようにIPアドレスを計画的に配布して、経路制御表ができるだけ大きくならないようにする
            - パフォーマンスの向上
                - ヘッダ長を固定し、ヘッダチェックサムを省くなど、ヘッダの構造を簡素化して、ルーターの負荷を減らす
                - ルーターに分割処理をさせない
            - プラグ&プレイ機能を必須にする
                - DHCPサーバーがない環境でもIPアドレスを自動的に割り当てる
                    - DHCP
                        - Dynamic Host Configuration Protocol
                        - コンピュータがネットワークに接続して通信する際に必要な設定情報を自動的に割り当てる機能
                        - DHCPサーバー: ネットワークなどに接続したいコンピュータに、IPアドレスなど必要な情報を自動的に発行するサーバー
                        - DHCPクライアント: 接続しようとするコンピュータに備わる機能です。コンピュータのユーザーは接続設定で内蔵されたDHCPクライアント機能を有効にします。すると、DHCPクライアントが適切な設定を取得してくれるため、設定を手動で行う必要がなくなります。
            - 認証機能や暗号化機能を採用する
                - IPアドレスの偽造に対するセキュリティ機能の提供や、盗聴防止機能を提供する
            - マルチキャスト、Mobile IPの機能をIPv6の拡張機能として定義
            - 16進数表記
            - 0が2つ以上連続して続く場合には0を省略し、コロンを2つ続けて表記できる
            - IPアドレスの先頭のビットパターンでIPアドレスの種類を区別する
            - グローバルユニキャストアドレスとリンクローカルユニキャストアドレス
                - グローバルユニキャストアドレス
                    - 全世界で一意に決まるアドレス
                    - ネットワーク部: 64bits
                        - グローバルルーティングプレフィクス: 48bits
                        - サブネットID: 16bits
                    - ホスト部: 64bits
                        - インターフェース部: 64bits
                        - MACアドレスを元にした値
                            - 通信相手に知られたくない場合、無関係な「一時アドレス」をつけることが可能
                - リンクローカルユニキャストアドレス
                    - データリンクの同一リンク内で一意に決まるアドレス
                    - 1111 1110 10
                    - FE80::/10
                    - ルーターを介さない同一リンク内での通信
                    - インターフェースID: 64ビット版のMACアドレスが格納される
                - ユニークローカルアドレス
                    - インターネットと通信を行わない場合に利用されるアドレス
                    - 1111 110
                    - FC00::/7
                    - 機械制御などの制御型ネットワーク
                    - 金融機関などの勘定系ネットワーク
                    - セキュリティを高めるためにインターネットとはNATゲートウェイ経由で通信する企業内のネットワーク
                    - できるだけ一意になるようにグローバルIDを乱数で決定する
                        - 企業の合併や、業務の統合、効率化などによりユニークローカルアドレスで作られたネットワーク同士を接続する可能性があるため
                    - 最小MTU: 1280オクテット
            - IPv6のヘッダフォーマット
                - version
                - Traffic Class
                    - TOS
                - Flow Label
                    - 20 bits
                    - 品質制御に利用されることを想定したフィールド
                - ペイロード長
                    - パケットのデータ部
                - 次のヘッダ
                - ホップリミット
                    - 8bits
                    - 通過できるルータの数を制限する
                    - 0になったら破棄
                - 送信元IPアドレス
                - 宛先IPアドレス
                - IPv6拡張ヘッダ
    - DNS
        - Domain Name System
        - Domain Name <-> IP Address
        - ローマ字とピリオドを使った名前からIPアドレス自動的に変換する
        - 組織内でホスト名とIPアドレスの関係を表すデータベースを管理できる
        - 通信をしたユーザーがホスト名・ドメイン名を入力すると、自動的にホスト名やIPアドレスが登録されているデータベースサーバーが検索され、そこからIPアドレスの情報を得る
        - ダイナミックDNS
            - IPアドレスが変化しても同じホスト名を利用できる
        - ドメイン名の構造
            - ドメイン名
                - ホストの名前や組織の名前を識別するための階層的な名前
            - 階層構造
                - Top Level Domain
                - country code TLD
                - generic TLD
        - ネームサーバー
            - ドメイン名を管理しているホストやソフトウェア
            - そのネームサーバーが設定された階層のドメインに関する情報を管理する
                - ゾーン: 管理する階層
            - それぞれのネームサーバーはしたの階層のネームサーバーのIPアドレスを知っており、ルートからネームサーバーが木構造のように結ばれている
            - 全てのネームサーバーはルートネームサーバーのIPアドレスをしているため、ルートから順番に辿ることで世界中のネームサーバーにアクセスできる
            - ルートネームサーバー
                - ルートの部分に設置されているサーバー
                - DNSによるデータの検索で最も重要な役割をになう
                - 次のレベルのネームサーバーのIPアドレスが登録されている
                    - ルートネームサーバー -> jp, orgを管理しているネームサーバー
            - ラウンドロビンDNS
                - 1つのホスト名に複数のIPアドレスを割り当てる
                - Webサーバーなどの負荷分散に利用される
        - リゾルバ
            - DNSに問い合わせを行うホストやソフトウェア
            - 通常、組織内のネームサーバーのIPアドレスを登録する
        - 処理順序
            - クライアントがwww.xxx.orgと通信する場合
            - DNSサーバーにIPアドレスを問い合わせる
            - IPアドレスを知らないため、ルートネームサーバーにwww.xxx.orgのIPアドレスを問い合わせる
            - ルートネームサーバーはxxx.orgのネームサーバーのIPアドレスを知っているため、そのアドレスを返す
            - xxx.orgのネームサーバーに問い合わせて、www.xxx.orgのIPアドレスを知る
            - クライアントにそのIPアドレスを伝える
            - クライアントとホストで通信が開始される
        - リゾルバやネームサーバーは。新たに知った情報をしばらくの間キャッシュする
        - DNSはインターネットに広がる分散データベース
            - ホスト名からIPアドレスを検索するだけではなく、さまざまな情報を格納する
    - ARP
        - Address Resolution Protocol
        - IP Address -> MAC Address
        - アドレス解決のためのプロトコル
        - 宛先IPアドレスを手掛かりにして、次にパケットを受け取るべき機器のMACアドレスを知りたいときに利用する
        - 宛先のホストが同一リンク上にない場合には、次ホップのルーターのMACアドレスをARPで調べる
        - IPv4で使用されるが、IPv6では使用されない
        - 仕組み
            - ARP要求パケット
                - IPアドレスからMACアドレスを知るために送信する
            - ARP応答パケット
                - 自分のMACアドレスを教えるために返送する
            - ARPによって取得したMACアドレスは数分間キャッシュされる
        - 両方必要な理由
            - IPアドレスを用いて、次にどのルーターを経由してパケットを送信するのかの道標とする
                - 最終目的地
            - MACアドレスを用いて、次のルータを示す
                - 各目標地点
        - RARP
            - Reverse Address Resolution Protocol
            - IP Address <- MAC Address
            - MACアドレスからIPアドレスを知りたい時
            - 組み立て機器において、IPアドレスを入力するインターフェースが存在しない場合
            - 組み立て機器において、DHCPが対応していない場合
            - DCHPで動的なIPアドレスが設定されては困る場合
            - RARPサーバーが必要
        - Gratuitous ARP
            - IPアドレスの重複を確認するため
            - スイッチングハブなどのMACアドレス学習テーブルを更新させるため
        - 代理ARP
            - ルーティングテーブルを使わずにIPパケットを別のセグメントに送りたい場合
            - 異なるセグメントに対するARP要求パケットが流れ、ルーターが自分のMACアドレスを返す。その結果、IPパケットはルーターに送られる。ルーターは受け取ったIPパケットを本来のIPアドレスが付いているノードに転送する。
            - 2つに分かれていたセグメントが1つのセグメントであるかのように振る舞う
            - サブネットマスクやルーティングテーブルを定義できない機器がある場合
            - 複数のサブネットを重ねて使用するVPN環境がある場合
    - ICMP
        - Internet Control Message Protocol
        - ネットワークが正常に動作しているか、異常が発生した時のトラブルシューティング
        - 機能
            - IPパケットが目的のホストまで届くかどうかを確認する機能
            - 何らかの原因でIPパケットが破棄された時にその原因を通知してくれる機能
            - 不十分な設定をよりよい設定に変更してくれる機能
        - ICMPによる情報の通知はIPを使って配送
        - ベストエフォート
        - 主なメッセージ
            - ICMP到達不能メッセージ
                - IPルーターがIPデータグラムを宛先に配送できない場合
                - 配送できなかった理由を示す
                - よく発生するエラー
                    - 0: Network Unreachable
                        - そのIPアドレスへの経路情報を持っていなかったこと
                    - 1: Host Unreachable
                        - そのコンピュータがネットワークに接続されていなかったこと
                    - 4: Fragmentation Needed and Don't Fragment was Set
                        - 経路MTU探索
            - ICMPリダイレクトメッセージ
                - 送信元ホストが最適ではない経路を使用しているのをルーターが検出した時に、そのホストに対して送信
                - ルーターがホストよりもよりよい経路情報を持っている場合
                - 自動的に追加された情報は一定時間後に消去する、という考えに基づきICMPリダイレクトメッセージによって追加された経路情報は、一定時間経過すると自動的に消去される
                - リダイレクトメッセージはトラブルの原因になるため、動作しないように設定されている場合もある
            - ICMP時間超過メッセージ
                - TTLが０になりIPデータグラムが破棄された時、送信元に送信
                - IPに生存期間が決められているのは経路制御にトラブルが発生して経路がループしているときなど、パケットが永久にネットワークを回り続けてネットワークが麻痺した状態になるのを防ぐため
                - パケットの到達範囲を限定したい場合には、あらかじめTTLを小さな値にしてからパケットを送る方法もある
            - ICMPエコーメッセージ
                - 通信したいホストやルーターなどにIPパケットが到達するかどうかを確認したい時に利用される
                - 相手先ホストに対してICMPエコー要求メッセージを送信し、相手先ホストからICMPエコー応答メッセージが返ってくれば到達可能
                - ping
            - ICMPルーター探索メッセージ
                - 自分がつながっているネットワークのルーターを見つけたい時に利用
            - ICMP拡張エコーメッセージ
                - パケットの宛先ノードの、別のインターフェースの状態を確認
                    - 複数のネットワークインターフェースが接続された機器の管理で役立つ
                    - 指定した別のインターフェースがIPv4で通信可能か、IPv6で通信可能かを調べられる
                - パケットの宛先ノードから、別のノードに通信可能かを確認
                    - 問い合わせたその機器のARPテーブルや近隣キャッシュの状態から指定した別のノードと通信可能かどうかを知らせる
        - traceroute
            - プログラムを実行したホストから特定の宛先のホストに到達するまでに、どのようなルーターを通過するのかを表示してくれるプログラム
            - IPの生存時間を1から順番に増やしながら、UDPパケットを送信し、ICMP時間超過メッセージを無理矢理返させる
        - ICMPv6
            - ICMPはIPv4の補助
            - ICMPv6がなければIPv6による通信ができない
            - ICMPを大きく2つに分類
                - エラーメッセージ
                - 情報メッセージ
            - 近隣探索
                - IPv6アドレスとMACアドレスの対応関係を調べる時には、近隣要請メッセージでMACアドレスを問い合わせ、近隣告知メッセージでMACアドレスを通知する
                - 近隣要請メッセージは、IPv6のマルチキャストアドレスを使用
                - DHCPサーバーが無い環境下でも、IPアドレスを自動設定できる
                - ルーターがないネットワークならば、MACアドレスを使ってリンクローカルユニキャストアドレスを作成する
                - ルーターがある環境ならば、ルーターからIPv6アドレスの上位ビットの情報を取得し、下位ビットにはMACアドレスを指定
    - DHCP
        - Dynamic Host Configuration Protocol
        - IPアドレスの設定を自動化したり、配布するIPアドレスの一括管理を行なったりするため
        - コンピュータをネットワークに接続しただけで、TCP/IPによる通信ができるようになる
        - プラグ＆プレイ
            - 物理的に機器を接続するだけで、特別な設定をしなくてもその機器が利用可能になること
        - 仕組み
            - DHCPサーバーを立ち上げる
                - そのセグメントのルーターがDHCPサーバーになることも多い
            - DHCPで配布するIPアドレスをDHCPサーバーに設定する必要がある
            - サブネットマスクや経路制御の情報、DNSサーバーのアドレスなども必要に応じて設定
            - 管理者がDHCPサーバーにDHCPで割り当てるIPアドレス、サブネットマスク、デフォルトルートを設定する
            - DHCP発見パケット: IPアドレスやネットマスクなどのネットワークの設定を要求
            - DHCP提供パケット: 使用してよいネットワークの設定を通知
            - DHCP要求パケット: 通知された設定を使用したいことを通知
            - DHCP確認応答パケット: 要求に対する許可通知
            - IPアドレスが不要になった場合にはDHCP解放パケットを送信する
            - DHCPによる設定には、通常制限時間が設定される。DHCPクライアントは、制限時間が超過する前に、DHCP要求パケットを送信して、延長したいことを通知する
        - DHCPサーバーの障害による通信不能を回避するため、複数のDHCPサーバーを起動することが奨励される
            - 複数のDHCPサーバーを起動すると、それぞれのサーバー内部に記録されているIPアドレスの配布情報が同じにならず、片一方のDHCPサーバーが割り当てたIPアドレスを別のDHCPサーバーが配布してしまう危険性がある
            - それを回避するための機能がある
                - DHCPサーバー
                    - IPアドレスを配布する前にICMPエコー要求パケットを送信し、返事が来ないことを確認する
                - DHCPクライアント
                    - DHCPサーバーから配布されたIPアドレスに対して、ARP要求パケットを送信し、応答がないことを確認する
        - DHCPリレーエージェント
            - 無数のセグメントが存在する環境において、DHCPサーバーの設定を一元管理する方法
            - それぞれのセグメントにDHCPサーバーを置く代わりに、DHCPリレーエージェントを設置し、DHCPリレーエージェントにはDHCPサーバーのIPアドレスを設定。DHCPサーバーには、それぞれのセグメント毎に配布するIPアドレスの範囲を登録
            - DHCPリレーエージェントは、DHCPクライアントが送信したDHCP要求パケットなどのブロードキャストパケットを受信すると、ユニキャストパケットにしてDHCPサーバーに転送する。DHCPサーバーには、転送されたDHCPパケットを処理し、DHCPリレーエージェントに応答を返す。DHCPリレーエージェントは、DHCPサーバーから送られてきたDHCPパケットを、DHCPクライアントに転送する。
                - DHCPパケットには、DHCPリクエストをしたホストのMACアドレスが書かれている。リレーエージェントはDHCPパケットの中に書かれているMACアドレスを使って、DHCPクライアントにパケットを返す。
    - NAT
        - Network Address Translator
        - IP Addresses within private networks <-> IP Addresses within global networks
        - ローカルなネットワークでプライベートIPアドレスを使用し、インターネットへ接続するときにグローバルIPアドレスへ変換する技術
        - NAPT
            - Network Address Ports Translator
            - TCPやUDPのポート番号も付け替えられる
            - 1つのグローバルIPアドレスで複数のホスト間の通信が可能になった
            - モバイルルーターやテザリング機能
        - セキュリティの向上やIPv4とIPv6の相互通信をするための技術
        - NAT/NAPT対応ルーターの内部ではアドレス変換のためのテーブルが自動的/固定的に作られる
        - プライベートネットワーク内の多数のホストから通信が行われる場合、変換先のグローバルIPアドレスが不足すると思われるが、実際にはポート番号を含めて変換処理を行うことで解決
        - 変換テーブルはNAPT対応ルーターによって自動的に更新される
        - ベーシックNAT
            - ポート変換せず、IPアドレスだけを変換するとき
        - NAT64/DNS64
            - IPv6 <-> IPv4
            - DNSとNATが連携して動作することで、IPv6環境からIPv4環境への通信を実現
            - IPv6ホストはDNSで問い合わせ、これに対してDNS64サーバーはIPv4アドレスが埋め込まれたIPアドレスを返す。そのアドレスでIPv6パケットを送ると、NAT64が通信相手のIPv4アドレスを認識し、IPv6ヘッダとIPv4ヘッダを付け替える。
        - CGN
            - Carrier Grade NAT
            - ISPレベルでNATをを行う技術
            - グローバルIPv4アドレスを配布せず、プライベートIPv4アドレスを配布
                - 各組織が使用するプライベートIPアドレス<->ISPから各組織に配布されたプライベートIPアドレス<->グローバルIPアドレス
            - NATを2段階で使用するため、通常のNATよりもトラブルが増える可能性がある
        - 問題点
            - NATの外側からイト側のサーバーに接続することができない
            - 変換テーブルの作成や変換処理のオーバーヘッドが生じる
            - 通信中にNATが異常動作して再起動した時には、すべてのTCPコネクションがリセットされる
            - NATが2台用意して故障時に切り替えるようにしても、TCPコネクションは必ず切れる
        - 解決方法
            - IPv6を使う
                - 利用できるIPアドレスが膨大になるため、会社や家庭内のすべての機器にグローバルIPアドレスを割り振ることが可能
            - NAT越え
                - NATがある環境を前提にアプリケーションを作成することにより、NATがあってもユーザーはそのことを意識することなく通信できるようにする方法
                - NATの内側のホストで動かしているアプリケーションが、NATの変換テーブルを作成するために、ダミーパケットをNATの外側に向かって送信する。NATはダミーのパケットとはわからずに、そのパケットのヘッダを読み取って変換テーブルを作成する。
    - IPトンネリング
        - IPv4 - IPv6 - IPv4
        - IPv6 - IPv4 - IPv6
        - 異なるプロトコル間を両端のプロトコルに対応したトンネルを用意することで、両プロトコルに対応する必要がない通信が可能になる
        - 一般的な環境ではルーターがマルチキャストパケットの経路制御に対応していないため、マルチキャストパケットがルーターを超えて伝わることはない。
            - トンネリングを使用することで、ルーターを通過するパケットをつ上のユニキャストパケットにできるため、遠く離れたマルチキャストパケットを送信できる
    - VRRP
        - Virtual Router Redundancy Protocol
        - 複数のルーターによる冗長化によって障害体制を高める仕組み
        - 1つがマスタールーター、別のルーターがバックアップルーター
        - 平常時はマスタールーターがデフォルトルーターとして定期的にVRRPパケットをマルチキャストを使って送る。バックアップルーターが3回分のVRRPパケットを受け取れなかった時にマスタールーターに障害が発生した判断して、バックアップルーターの1つがデフォルトルーターに切り替わる
        - バーチャルIPアドレスと仮想ルーターMACアドレスを引き継ぐことで故障時にデフォルトルートの変更なしにバックアップルーターへ切り替わることが可能になる
    - IPマルチキャスト関連技術
        - マルチキャストの通信は主にUDP
        - 受信者がいるかどうかの確認が必要
            - IPv4: IGMP
            - IPv6: MLD(ICMPv6)
            - 役割
                - ルーターにマルチキャストを受信したいと伝える
                - スイッチングハブに受信したいマルチキャストアドレスを通知
    - IPエニーキャスト
        - 同じサービスを提供するサーバーに同じIPアドレスをつけて、日本なら日本のサーバー、アメリカならアメリカのサーバーというように、最寄りのサーバーと通信できるようにする方法
        - 例
            - DNSルートネームサーバー
                - 歴史的なプロトコル制約により、DNSルートネームサーバーに設定できるIPアドレスは13個に制限される
                - DNSルートサーバーに要求パケットを送る時には、地域毎に適したサーバーにIPパケットが送られ、そこから応答が返ってくる
    - 通信品質の制御
        - RSVP
            - Resource Reservation Protocol
                - IntServ: エンドツーエンドできめ細かい優先制御を提供
                    - 特定のアプリケーション間の通信に対して通信品質の制御を提供する仕組み
                        - 送信元IPアドレス
                        - 宛先IPアドレス
                        - 送信元ポート番号
                        - 宛先ポート番号
                        - プロトコル番号
                    - 必要な時に必要なだけ行われる
                    - フローのセットアップ: 経路上のルーターに品質制御の設定を行う
        - DiffServ
            - 相対的で大雑把な優先制御
            - DiffServドメイン
                - DiffServにより通信品質を制御するネットワーク
                - DiffServドメインの境界にあるルーターは、DiffServドメインの中に入ってくるIPパケットのヘッダの中にあるDSCPフィールドを書き換える
                    - 優先制御を望む顧客のパケットに対しては優先される値を設定し、そうでない顧客のパケットに対しては優先されない値を設定する
                - DiffServドメイン内にあるルーターは、IPヘッダのDSCPフィールドの値を見て優先されるパケットを優先的に処理する。優先度の低いパケット程、輻輳発生時に廃棄されやすくなる
    - Mobile IP
        - ホストが接続しているサブネットが変わってもIPアドレスが変わらないようにする技術
        - 今まで使っていたアプリケーションを変更することなしに、IPアドレスが変わる環境でも通信し続けることが可能
        - 役割
            - 移動ホスト
                - 移動してもIPアドレスが変わらないホスト
            - ホームエージェント
                - ホームネットワークに存在し、移動ホストがどこにいるか監視し、移動先にパケットを転送する
            - 外部エージェント
                - 移動先で移動ホストをサポートするために使用される。移動ホストが接続する可能性のあるすべての箇所に必要
        - 問題点
            - 外部エージェントが存在しないネットワークには移動できない
            - IPパケットが三角形のルートを通るため、効率が悪い
            - セキュリティを高めるため、自組織から外部に出ていくパケットの送信元IPアドレスが、自組織で使われていないIPアドレスの場合は、廃棄するように設定している組織が増えている。
    - Mobile IPv6
        - 外部エージェントの機能は、Mobile IPv6を実装した移動ホスト自身が担う
        - 経路最適化におり、ホームエージェントを経由しないで、直接通信できる
        - IPv6ヘッダの送信元IPアドレスには気付アドレスをつけて、ファイアウォールで廃棄されないようにする
- トランスポート層
    - 通信するプログラムを指定する役割
    - サーバープログラム
        - クライアントからの要求を処理して、サービスを提供する
        - デーモン
            - UNIX上における、ホスト/サーバー上で常時起動されていて特定の処理を行うプロセス
        - inetd
            - 個々のデーモンを別々に動かすのではなく、その代表としてクライアントからの要求を待つスーパーデーモン
        - 各指定ポート番号に応じた個々のデーモンがそれ以降の処理を行う
    - TCP
        - Transmission Control Protocol
        - コネクション型、信頼性のあるストリーム型のプロトコル
        - アプリケーションがTCPを使ってメッセージを送信すると、送信した順番は保たれるが、区切り目のないデータ構造として、受信した側のアプリケーションに届く
        - 機能
            - 順序制御
            - 再送制御
            - フロー制御
            - 輻輳制御
            - ネットワークの利用効率を向上させる仕組み
        - 信頼性が必要な通信
        - インターネットを介して大量のデータを転送する場合
        - ビデオオンデマンドやライブ配信など、即時性がそれほど必要のない動画や音声の再生
        - 利用する回線を想定せず、どのような回線でもそれなりの性能を期待する場合
    - 信頼性の確認
        - ACK
            - Positive Acknoledgement
            - TCPにおいて、送信したデータが受信ホストに到達したときに受信ホストは送信ホストにデータが到達したことを知らせる
            - データを送信し、一定時間内に確認応答が返ってこない場合にはデータが喪失したと判断してもう一度データを送信する
        - シーケンス番号
            - データの確認応答処理や再送制御、重複制御に用いる
        - NACK
            - Negative Acknoledgement
    - 再送タイムアウトの決定
        - 再送せずに確認応答の到着を待つ時間
        - パケットを送信した際に測る、ラウンドトリップ時間とその揺らぎを合計した値よりも少し大きい値
        - 再送しても確認応答がされない場合は、再度送信し、確認応答を待つ時間を指数関数的に増やす
        - 特定の回数再送を繰り返しても確認応答がない場合には、ネットワークや相手のホストに異常が発生していると判断し、強制的にコネクションを切断する
    - コネクション管理
        - SYNパケット: コネクション確立要求
        - FINパケット: コネクション切断要求
    - データ送信
        - コネクションの確立時に、通信を行うデータ単位を決定
        - 理想的なMSSは、IPで分割処理されない最大データ長
        - 送受信のホスト間でMSSを決定。コネクション確立要求を送る際に、TCPヘッダにMSSオプションをつけ、自分のインターフェースに適したMSSを通知
        - ウインドウ制御
            - パケットの往復時間が長くなっても性能が低下しないように制御
            - 送信ホストが、送信したセグメントに対する確認応答を待たずに、複数のセグメントを送信する
            - ウインドウサイズ
                - 確認応答を待たずに送信できるデータの大きさ
                - 大きな送受信バッファを用意し、複数のセグメントを並列に確認応答する
            - スライディングウィンドウ
                - 順次複数のセグメントを並列的に送信して通信性能を向上させる仕組み
            - 高速再送制御
                - 送信セグメントが失われた場合
                - 次に受信すべきシーケンス番号以外のデータを受け取った場合には、今までに受信したデータに対する確認応答を返す
                - 送信ホストでは、一度受け取った確認応答が示しているデータを再送
                - タイムアウトによる再送制御に比べて高速に動作
        - フロー制御
            - TCPにおいて、送信側が受信側の受信能力に合わせてパケット送信量を制御
            - 受信ホストが送信ホストに受信可能なデータサイズを通知する
                - =ウインドウサイズ
            - 受信側のバッファが溢れそうになると、このウインドウの値を小さく設定して送信ホストに伝えデータ送信量を抑制する
        - 輻輳制御
            - スロースタート
                - 輻輳を防ぐため、通信開始時に特定のアルゴリズムに従ってデータの送信量を制御する
                - 送信側でデータの送信量を調節するための輻輳ウインドウを定義
                - 確認応答がなされるたびに1MSSずつ輻輳ウインドウを増やし、相手のホストから通知されたウインドウの範囲内で、データパケットを送信
                - タイムアウトによる再送時には、輻輳ウインドウを1にしてからスロースターとをやり直す
                - スロースタート閾値
                    - パケットが往復するたびに輻輳ウインドウが1,2,4,...と指数関数的に大きくなるため、トラフィックが急激に増加してネットワークが輻輳状態になる可能性がある。輻輳ウインドウがその大きさを超えると、確認応答されるたびに、(1セグメントのオクテット数*輻輳ウインドウ)/1セグメントのオクテット数分増やす
                    - TCPの通信開始時にはスロースタート閾値はウインドウの最大値と同じ大きさ
                    - タイムアウトによる再送は発生した時に、輻輳ウインドウの半分の大きさに設定
        - ネットワークの利用効率を高める仕組み
            - Nagleアルゴリズム
                - ネットワークの利用効率を高めるため
                - その瞬間に送信側に送信すべきデータがあったとしてもそのデータが少ない場合にはすぐに送信せずに、送信を遅らせる処理
                - 待っている間に送るべきデータが溜まって、1つのパケットで多くのデータを送ることができれば、ネットワークの利用効率が向上する
                - TCPがデータセグメントを送る条件
                    - すべての送信済みデータが確認応答されている場合
                    - 最大セグメント長のデータを送信できる場合
            - 遅延確認応答
                - データを受信してもすぐに確認応答をせずに遅延させる方法
                - 2*最大セグメント長のデータを受信するまで確認応答をしない
                - そうでない場合は、確認応答を最大で0.5s遅延させる
            - ピギーバック
                - TCPにおいて確認応答と返事のデータパケットを1つのパケットで送ることが可能
                - 送受信するパケットの数を減らせる
                - 遅延確認応答の処理が必要
    - UDP
        - User Datagram Protocol
        - コネクションレス型、信頼性のないデータグラム型のプロトコル
        - 細かい処理は上位層のアプリケーションが担うことになる
        - ユーザーの言うことをなんでも聞くけれど、ユーザーが全てを考慮して上位層のプロトコルを考えアプリケーションを作る必要がある
        - 用途
            - 総パケット数が少ない通信
                - DNS
                - SNMP
            - 動画や音声などのマルチメディア通信
            - LANなどの特定のネットワークに限定したアプリケーションの通信
            - 同報性が必要な通信
                - ブロードキャスト
                - マルチキャスト
    - ポート番号
        - 同一のコンピューター内で通信を行っているプログラムを識別するときに利用される
    - 通信の識別
        - IPヘッダ
            - 送信元IPアドレス
            - 宛先IPアドレス
            - プロトコル番号(TCP/IP)
        - TCPヘッダ
            - 送信元ポート番号
            - 宛先ポート番号
    - ポート番号の決め方
        - 静的に決定
            - アプリケーション毎にどのポート番号を使うかを固定的に決める方法
            - Well Knownポート番号
                - 0~1023
            - 1024~49151の番号も正式に登録されている場合がある
        - 動的に決定
            - サービスを提供する側はポート番号が決まっている必要があるが、サービスを受ける側のポート番号は必ずしも決まっている必要はない
            - OSに任せる
                - 同じポート番号が必要になるたびにポート番号の数を1ずつ増やす
            - 49152~65535
    - ポート番号とプロトコル
        - 異なるトランスポートプロトコルの場合は同じポート番号を使用することが可能
    - TCPに全てを任せるべきか、UDPを選択しアプリケーションが細かい制御を任せるべきか
    - そのほかのトランスポートプロトコル
        - QUIC
            - Quick UDP Internet Connections
            - Google社が提案し、IETFによって標準化が進められているトランスポートプロトコル
            - Webの通信に利用することを目的にしており、今後TCPに取って代わる可能性がある
            - UDP + QUICで一つのトランスポートプロトコル
            - 認証・暗号化
                - QUIC自体が認証と暗号化を提供
            - 低遅延のコネクション管理
                - TCPにおけるコネクション管理とTLSにおけるハンドシェークを同時に行い、低遅延でコネクションを確立
            - 多重化
                - 1このコネクションで複数のストリームを同時に扱う
            - 再送処理
                - TCPよりきめ細かくラウンドトリップ時間を計測し、高精度な再送処理を行う
            - コネクションのマイグレーション
                - IPアドレスが変わったときにもコネクションが維持されるようにする
        - SCTP
            - Stream Control Transmission Protocol
            - データの到達性に関する信頼性を提供するトランスポートプロトコル
            - メッセージ単位の送受信
                - 送信側のアプリケーションが決めたメッセージサイズが受信側のアプリケーションでわかる
            - マルチホーミングに対応
                - 複数のNICが付いているホストで、使用できるNICが変化しても通信を継続できる
                - 複数のIPアドレスを管理しながら通信ができるため、無線LANといーさねとを切り替えても通信を維持できる
            - 複数のストリームの通信
                - TCPにおいて複数のコネクションを確立して通信を行うような効果を、1つのコネクションで実現する
            - メッセージの生存期間を定義できる
                - 生存期間を過ぎたメッセージの再送は行わない
            - 通信するアプリケーション間で小さなメッセージをたくさん送るときに向く
        - DCCP
            - Datagram Congestion Control Protocol
            - UDPを補うプロトコル
            - データの到達性に関する信頼性はない
            - コネクション型で、コネクションの確立と切断処理がある
            - 輻輳制御が可能
        - UDP-Lite
            - UDPの機能を拡張したトランスポートプロトコル
            - エラー判別のためのチェックサムの計算をアプリケーションで決めることができる
    - UDPヘッダのフォーマット
        - 送信元ポート番号
        - 宛先ポート番号
        - パケット長パケット長
            - UDPのヘッダの長さとデータの長さの和が格納される
            - 単位はオクテット
        - チェックサム
            - UDPのヘッダとデータの信頼性を提供
            - UDP擬似ヘッダをUDPデータグラムの前につける。全長が16ビットの倍数になるようにデータの最後に0を追加する。UDPヘッダのチェックサムフィールドを0にする。そして、16ビット単位で1の補数の和を求め、もとまった和の補数をチェックサムフィールドに入れる。
            - 受信ホストは、UDPデータグラムを受信後、IPヘッダからIPアドレスの情報を得てUDP擬似ヘッダを作成し、チェックサムを再計算する。チェックサムを含むすべてのデータを足した結果が「16ビットすべてが1」になると正しい値になる
    - TCPヘッダのフォーマット
        - 送信元ポート番号
        - 宛先ポート番号
        - シーケンス番号
            - 送信したデータの位置
        - 確認応答番号
            - 32ビット長のフィールドで示す
            - 次に受信すべきデータのシーケンス番号
        - データオフセット
            - TCPヘッダの長さ
        - 予約
            - 将来の拡張のために用意されているフィールド
        - コントロールフラグ
            - 通信時における対話情報
        - ウインドウサイズ
            - 受信可能なデータサイズ
        - チェックサム
        - 緊急ポインタ
            - 緊急を要するデータの格納場所を示すポインタ
            - データ領域の先頭からこの緊急ポインタで示されている数値分のデータ
        - オプション
            - TCPによる通信の性能を向上のため
    - ルーティング
        - 静的経路制御
            - ルーターやホストに固定的に経路情報を設定する
            - 経路情報を手入力が必要
            - ネットワークに障害が発生したときに、基本的に自動的に障害地点を迂回するような制御ができない
        - 動的経路制御
            - ルーティングプロトコルを動作させ、自動的に経路情報を設定する
            - ルーティングプロトコルの設定が必要
            - 経路制御に必要な情報を交換するために、隣り合うルーター間で定期的にメッセージを交換する
            - 情報がバケツリレー式に伝えられ、ネットワークの隅々まで伝わると経路制御が完成し、IPパケットを正しく転送できるようになる
        - 経路を制御する範囲
            - IGP
                - Interior Gateway Protocol
                - ドメイン内のルーティングプロトコル
                - 地域ネットワークやプロバイダ内部のどのホストなのか識別
            - EGP
                - Exterior Gateway Protocol
                - ドメイン間のルーティングプロトコル
                - 地域ネットワークやプロバイダ間の経路制御
            - 自律システムとルーティングプロトコル
                - 自律システム/経路制御ドメイン
                    - 同一の決まり、考え方によって経路制御を管理する単位
                    - ISP, 地域ネットワーク
            - 経路制御アルゴリズム
                - 距離ベクトル型
                    - 距離と方向によって目的のネットワークやホストの位置を決定する方法
                    - ルーター間では、ネットワーク向きと距離に関する情報を交換する
                    - 向きと距離の情報から経路制御表を作成する
                    - ネットワークの構造が複雑になると、経路制御情報が安定するまでに時間がかかる
                - リンク状態型
                    - ルーターがネットワーク全体の接続状態を理解して経路制御表を作成する方法
                    - 各ルーターの情報が同じになれば正しい経路制御が行われることになる
                    - ネットワークトポロジーから経路制御表を求める計算は複雑
                    - 高いCPU能力と多くのメモリ資源が必要になる
                - RIP
                    - Routing Information Protocol
                    - 距離ベクトル型
                    - LANで使用
                    - 経路制御情報を定期的にネットワーク上にブロードキャストする
                    - 送信間隔は30秒であり、この経路情報が来なkなったら接続が切れたと判断する
                    - パケットの喪失を考慮して、5回待ち、6回待っても来ない場合、接続が切れたと判断する
                    - できるだけ少ない数のルーターを通過して、目的のIPアドレスに到達するように制御される。距離ベクトルアルゴリズムにより距離ベクトルデータベースが作成されたら、距離が小さい経路を抜き出して経路制御表が作成される。
                    - サブネットマスクを利用した場合のRIPの処理
                        - インターフェースにつけられているIPアドレスからクラスで判断したネットワークアドレスと、経路制御情報で流れてきたアドレスからクラスで判断したネットワークアドレスをそれぞれ求め、両者が同じネットワークアドレスになった場合には、インターフェースに付けられているネットワークアドレスの長さと同じとみなす
                        - 異なる場合には、そのIPアドレスをクラスで判断したネットワークアドレスとして扱う
                    - 無限カウント
                        - 過去に伝えた情報を逆に教えられ、お互いに伝え合ってしまう問題
                        - 距離16を通信不能とする。
                        - Split Horizon: 経路情報を教えられたインターフェースには教えられた経路情報を流さない
                        - ループのあるネットワークは難しい
                            - 逆向きの回線が迂回路になるため、経路情報が巡回する。ループの外部で通信障害が発生した時には、正しく情報が伝えられなくなる
                            - ポイズンリバース
                                - 経路が切れた時、その情報を流さないのではなく、通信不能であることを表す距離16として流す。
                            - トリガーアップデート
                                - 情報が変化した時、30秒待たずにすぐに伝える
                - RIP2
                    - RIPのver.2
                    - マルチキャストを使用
                    - サブネットマスク対応
                    - ルーティングドメイン
                        - 1つのネットワーク上で論理的に独立した複数のRIPが使えるようになる
                    - 外部ルートタグ
                        - BGPなどから得た経路制御情報をRIPを使って、AS内に通知する時に用いる
                    - 認証キー
                        - パスワードを用いて、自分が認識できるパスワードを持っているパケットのみ受容する
                - OSPF
                    - Open Shortest Path First
                    - リンク状態型
                    - ループのあるネットワークでも安定した経路制御を行える
                    - サブネットマスクの対応
                    - エリア
                        - ネットワークの論理的な領域
                        - 不必要なルーティングプロトコルのやり取りを減少
                        - ネットワーク同士やホスト同士をまとめてグループ化したもの
                        - バックボーンエリア
                            - 各エリアは必ずバックボーンエリアに接続されている必要がある
                    - 各ルーターはネットワークのトポロジーを完全に把握し、最短の経路を求めるために、各リンクに紐づけられたコストから合計値が小さくなるように選択する
                    - Neighboring Router
                        - 隣接ルーター
                        - 同一リンクに接続されているルーター
                        - イーサネット上などに複数のルーターが同一リンクに接続されている時には、すべての隣接ルーター間で経路情報が交換されているわけではなく、指名ルーターが決められ、そのルーターを中心に経路制御情報が交換される
                    - 役割ごとに5種類のパケットを用意する
                        - HELLO: 隣接ルーターの確認、指名ルーターの決定
                        - データベース記述: データベースの要約情報
                        - リンク状態要求: データベースのダウンロード要求
                        - リンク状態更新: データベースの更新情報
                        - リンク状態確認応答: リンク状態更新の確認応答
                    - 動作の概要
                        - HELLOパケットを通常10秒に1回送信する
                        - 4回待っても返事が来ない場合、接続が切れたと判断する
                        - 接続状態に変化があった場合には、リンク状態更新パケットを送信して、他のルーターにネットワークの状態の変化を伝える
                            - ネットワークLSA
                                - ネットワークを中心にして作成した情報、そのネットワークにはどのルーターが接続されているかを表す
                            - ルーターLSA
                                - ルーターを中心にして作成した情報、そのルーターにはどのネットワークが接続されているかを表す
                        - ダイクストラ法を用いて最短経路を求め、経路制御表の作成を行う
                    - 構成
                        - エリア - バックボーンエリア - エリア
                        - 各ルーター
                            - 内部ルーター
                            - エリア境界ルーター
                            - バックボーンルーター
                            - AS境界ルーター兼バックボーンルーター
                            - AS境界ルーター兼内部ルーター
                        - 各エリア内のルーターはそのエリア内のトポロジーのデータベースを持つ
                        - エリア外の経路に関しては、エリア境界ルーターからの距離のみ持つ
                        - 経路情報を減らし、処理の負荷を軽くする
                        - 







